let s=[],u=0;const a=4;let h=0;const g=e=>{let f=[],l={get(){return l.lc||l.listen(()=>{})(),l.value},lc:0,listen(t){return l.lc=f.push(t),()=>{for(let i=u+a;i<s.length;)s[i]===t?s.splice(i,a):i+=a;let n=f.indexOf(t);~n&&(f.splice(n,1),--l.lc||l.off())}},notify(t,n){h++;let i=!s.length;for(let r of f)s.push(r,l.value,t,n);if(i){for(u=0;u<s.length;u+=a)s[u](s[u+1],s[u+2],s[u+3]);s.length=0}},off(){},set(t){let n=l.value;n!==t&&(l.value=t,l.notify(n))},subscribe(t){let n=l.listen(t);return t(l.value),n},value:e};return l},c=5,v=6,d=10;let E=(e,f,l,t)=>(e.events=e.events||{},e.events[l+d]||(e.events[l+d]=t(n=>{e.events[l].reduceRight((i,r)=>(r(i),i),{shared:{},...n})})),e.events[l]=e.events[l]||[],e.events[l].push(f),()=>{let n=e.events[l],i=n.indexOf(f);n.splice(i,1),n.length||(delete e.events[l],e.events[l+d](),delete e.events[l+d])}),T=1e3,p=(e,f)=>E(e,t=>{let n=f(t);n&&e.events[v].push(n)},c,t=>{let n=e.listen;e.listen=(...r)=>(!e.lc&&!e.active&&(e.active=!0,t()),n(...r));let i=e.off;return e.events[v]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let r of e.events[v])r();e.events[v]=[]}},T)},()=>{e.listen=n,e.off=i}});export{g as a,h as e,p as o};
